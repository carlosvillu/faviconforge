# Internationalization (i18n)

## Overview

This template supports multiple languages using `react-i18next`. Currently supported:
- **English (en)** - Default language
- **Spanish (es)**

## Architecture

```
Browser Request
      ‚Üì
Server (root.tsx loader)
  - Read cookie "lang"
  - If no cookie: parse Accept-Language header
  - Detect locale (en/es)
  - Set cookie if needed
  - Create i18next instance for SSR
      ‚Üì
SSR Render with translations
      ‚Üì
Client hydration with same locale
```

## Translation Files

Location: `app/locales/`

```
app/locales/
‚îú‚îÄ‚îÄ en.json    # English (default)
‚îî‚îÄ‚îÄ es.json    # Spanish
```

## Key Philosophy

### 1. Flat Structure (No Nesting)

Keys are flat, not nested. This keeps things simple and avoids deep object access.

```json
// ‚úÖ CORRECT
{
  "login_title": "Log in",
  "login_error": "Error logging in"
}

// ‚ùå WRONG
{
  "login": {
    "title": "Log in",
    "error": "Error logging in"
  }
}
```

### 2. Semantic Keys (Based on Meaning)

Keys describe **what the text means**, not where it appears.

```json
// ‚úÖ CORRECT - Describes meaning
{
  "invalid_email": "Invalid email",
  "password_min_length": "Password must be at least 8 characters"
}

// ‚ùå WRONG - Describes position
{
  "login_form_field_1_error": "Invalid email",
  "signup_page_password_hint": "Password must be at least 8 characters"
}
```

### 3. Reusable Keys

If the same text appears in multiple places, use ONE key.

```json
// ‚úÖ CORRECT - Reusable
{
  "email_label": "Email",        // Used in login, signup, profile
  "loading": "Loading..."        // Used everywhere
}

// ‚ùå WRONG - Duplicated
{
  "login_email_label": "Email",
  "signup_email_label": "Email",
  "profile_email_label": "Email"
}
```

### 4. Key Naming Convention

Use `snake_case` with logical prefixes:

| Prefix | Usage | Example |
|--------|-------|---------|
| `*_title` | Page/section titles | `login_title`, `pricing_title_part1` |
| `*_label` | Form labels | `email_label`, `password_label` |
| `*_placeholder` | Input placeholders | `email_placeholder` |
| `*_error` | Error messages | `login_error`, `signup_error` |
| `*_description` | Descriptive text | `hero_description` |
| `*_cta` | Call-to-action buttons | `pricing_cta` |
| `invalid_*` | Validation errors | `invalid_email`, `invalid_credentials` |

## Adding New Literals

### Step 1: Check if a key already exists

Before creating a new key, search `app/locales/en.json` for existing keys that might fit your use case.

```bash
# Search for existing keys
grep -i "email" app/locales/en.json
```

### Step 2: Add to BOTH translation files

Always add the key to **all** locale files simultaneously:

**`app/locales/en.json`**
```json
{
  "new_feature_title": "My New Feature"
}
```

**`app/locales/es.json`**
```json
{
  "new_feature_title": "Mi Nueva Funcionalidad"
}
```

### Step 3: Use in components

```tsx
import { useTranslation } from 'react-i18next'

export function MyComponent() {
  const { t } = useTranslation()
  
  return <h1>{t('new_feature_title')}</h1>
}
```

### Step 4: For Zod validation schemas

Zod schemas receive the `t` function to translate error messages:

```tsx
const createSchema = (t: (key: string) => string) =>
  z.object({
    email: z.string().email(t('invalid_email')),
    password: z.string().min(8, t('password_min_length')),
  })

// In component:
const { t } = useTranslation()
const schema = createSchema(t)
```

## Adding a New Language

### Step 1: Create the translation file

Copy `en.json` as a template:

```bash
cp app/locales/en.json app/locales/fr.json
```

### Step 2: Translate all values

Edit `fr.json` and translate each value (keep keys identical):

```json
{
  "login_title": "Se connecter",
  "email_label": "E-mail",
  ...
}
```

### Step 3: Register the locale

**`app/lib/i18n.ts`**
```typescript
export const SUPPORTED_LOCALES = ['en', 'es', 'fr'] as const  // Add 'fr'
```

**`app/lib/i18n.ts`** (in resources)
```typescript
import fr from '~/locales/fr.json'

const resources = {
  en: { translation: en },
  es: { translation: es },
  fr: { translation: fr },  // Add French
}
```

**`app/lib/i18n.client.ts`** (same changes)
```typescript
import fr from '~/locales/fr.json'

const resources = {
  en: { translation: en },
  es: { translation: es },
  fr: { translation: fr },
}
```

### Step 4: Add to language selector

**`app/components/LanguageSelector.tsx`**
```typescript
const LANGUAGE_OPTIONS: { locale: Locale; flag: string; label: string }[] = [
  { locale: 'en', flag: 'üá¨üáß', label: 'English' },
  { locale: 'es', flag: 'üá™üá∏', label: 'Espa√±ol' },
  { locale: 'fr', flag: 'üá´üá∑', label: 'Fran√ßais' },  // Add French
]
```

### Step 5: Update E2E tests if needed

If tests assert specific text, ensure they use English (default) or handle language detection.

## Language Detection Flow

1. **Cookie check**: If `lang` cookie exists and is valid ‚Üí use it
2. **Accept-Language header**: Parse browser's preferred languages ‚Üí use first supported match
3. **Default**: Fall back to English (`en`)

## Changing Language at Runtime

Users can change language via the `LanguageSelector` component in the header:

```typescript
import { changeLanguage } from '~/lib/i18n.client'

// Changes language and updates cookie
changeLanguage('es')
```

## Current Translation Keys

See `app/locales/en.json` for the complete list of available keys, organized by:

- **Common**: `logout`, `login`, `signup`, `loading`, etc.
- **Form labels**: `email_label`, `password_label`, etc.
- **Validation errors**: `invalid_email`, `password_min_length`, etc.
- **Auth pages**: `login_title`, `signup_title`, etc.
- **Landing sections**: `hero_*`, `how_it_works_*`, `demo_*`, `pricing_*`, `cta_*`, `footer_*`
- **Roles**: `role_podcaster`, `role_listener`, etc.
